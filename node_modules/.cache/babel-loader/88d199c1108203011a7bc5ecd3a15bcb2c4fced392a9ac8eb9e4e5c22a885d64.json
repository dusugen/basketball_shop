{"ast":null,"code":"var _jsxFileName = \"/home/dusugen/react-pizza/src/pages/Home.tsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect, useRef } from \"react\";\nimport qs from \"qs\";\nimport { useNavigate } from \"react-router-dom\";\nimport \"../scss/app.scss\";\nimport Categories from \"../components/Categories\";\nimport Sort, { sortList } from \"../components/Sort\";\nimport Skeleton from \"../components/PizzaBlock/Skeleton\";\nimport PizzaBlock from \"../components/PizzaBlock/PizzaBlock\";\nimport Pagination from \"../components/Pagination/Pagination\";\nimport { useSelector } from \"react-redux\";\nimport { selectFilter, setCategoryId, setCurrentPage, setFilters } from \"../redux/slices/filterSlice\";\nimport { fetchPizzas } from \"../redux/slices/pizzaSlice\";\nimport { useAppDispatch } from \"../redux/store\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction Home() {\n  _s();\n  const navigate = useNavigate();\n  const {\n    categoryId,\n    sort,\n    currentPage,\n    searchValue\n  } = useSelector(selectFilter);\n  const {\n    items,\n    status\n  } = useSelector(state => state.pizza);\n  const dispatch = useAppDispatch();\n  const onChangeCategory = useCallback(id => dispatch(setCategoryId(id)), []);\n  const onChangePageCount = useCallback(num => dispatch(setCurrentPage(num)), []);\n  const isSearch = useRef(false);\n  const isMounted = useRef(false);\n\n  // Запрос через асинхронный диспатч на сервер\n  const fetchPizza = async () => {\n    const category = categoryId > 0 ? `category=${categoryId}` : \"\"; // сортировка по категориям\n    const sortBy = sort.sortProperty.replace(\"-\", \"\"); // убираем \"-\" из параметров\n    const order = sort.sortProperty.includes(\"-\") ? \"asc\" : \"desc\"; // указываем тип фильтрации\n    const search = searchValue ? `&name=${searchValue}` : \"\"; // поиск по мячам\n\n    await dispatch(fetchPizzas({\n      currentPage: String(currentPage),\n      category,\n      sortBy,\n      order,\n      search\n    }));\n  };\n  // Убираем отображение в URL параметров при первом рендере страницы\n  useEffect(() => {\n    if (isMounted.current) {\n      const queryString = qs.stringify({\n        sortProperty: sort.sortProperty,\n        categoryId,\n        currentPage\n      });\n      navigate(`?${queryString}`);\n    }\n    isMounted.current = true;\n  }, [categoryId, sort.sortProperty, searchValue, currentPage]);\n\n  // Если был первый рендер, проверяем URL-параметры и сохраняем в redux\n\n  useEffect(() => {\n    if (window.location.search) {\n      const params = qs.parse(window.location.search.substring(1));\n      const sort = sortList.find(item => item.sortProperty === params.sortBy);\n      dispatch(setFilters({\n        searchValue: params.search,\n        categoryId: Number(params.category),\n        currentPage: Number(params.currentPage),\n        sort: sort || sortList[0]\n      }));\n      isSearch.current = true;\n    }\n  }, []);\n\n  // Проверяем, если ли в адресной строке данные.\n  useEffect(() => {\n    fetchPizza();\n    isSearch.current = false;\n  }, [categoryId, sort.sortProperty, searchValue, currentPage]);\n\n  // Генерация  компонентов мячей\n  const pizzas = items.map(obj => /*#__PURE__*/_jsxDEV(PizzaBlock, {\n    ...obj\n  }, obj.id, false, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 42\n  }, this));\n  const skeletons = [...new Array(4)].map((_, index) => /*#__PURE__*/_jsxDEV(Skeleton, {}, index, false, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__top\",\n      children: [/*#__PURE__*/_jsxDEV(Categories, {\n        value: categoryId,\n        onClickCategory: onChangeCategory\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Sort, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this), status === \"error\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__error-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\uD83D\\uDE15\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: [\"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E, \\u043D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u043E\\u0442\\u043E\\u0431\\u0440\\u0430\\u0437\\u0438\\u0442\\u044C \\u043C\\u044F\\u0447\\u0438.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 13\n        }, this), \" \\u041F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u0435 \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435.\", \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"content__title\",\n        children: \"\\u0412\\u0441\\u0435 \\u043C\\u044F\\u0447\\u0438\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"content__items\",\n        children: status === \"loading\" ? skeletons : pizzas\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true), /*#__PURE__*/_jsxDEV(Pagination, {\n      currentPage: currentPage,\n      onChangePage: num => {\n        onChangePageCount(num);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 106,\n    columnNumber: 5\n  }, this);\n}\n_s(Home, \"BvAZF6/e85Ecgg7HkOErM4TwDgg=\", false, function () {\n  return [useNavigate, useSelector, useSelector, useAppDispatch];\n});\n_c = Home;\nexport default Home;\nvar _c;\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"names":["React","useCallback","useEffect","useRef","qs","useNavigate","Categories","Sort","sortList","Skeleton","PizzaBlock","Pagination","useSelector","selectFilter","setCategoryId","setCurrentPage","setFilters","fetchPizzas","useAppDispatch","Home","navigate","categoryId","sort","currentPage","searchValue","items","status","state","pizza","dispatch","onChangeCategory","id","onChangePageCount","num","isSearch","isMounted","fetchPizza","category","sortBy","sortProperty","replace","order","includes","search","String","current","queryString","stringify","window","location","params","parse","substring","find","item","Number","pizzas","map","obj","skeletons","Array","_","index"],"sources":["/home/dusugen/react-pizza/src/pages/Home.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useRef } from \"react\";\nimport qs from \"qs\";\nimport { useNavigate } from \"react-router-dom\";\n\nimport \"../scss/app.scss\";\nimport Categories from \"../components/Categories\";\nimport Sort, { sortList } from \"../components/Sort\";\nimport Skeleton from \"../components/PizzaBlock/Skeleton\";\nimport PizzaBlock from \"../components/PizzaBlock/PizzaBlock\";\nimport Pagination from \"../components/Pagination/Pagination\";\nimport { useSelector } from \"react-redux\";\nimport {\n  selectFilter,\n  setCategoryId,\n  setCurrentPage,\n  setFilters,\n} from \"../redux/slices/filterSlice\";\nimport { fetchPizzas, SearchPizzaParams } from \"../redux/slices/pizzaSlice\";\nimport { RootState, useAppDispatch } from \"../redux/store\";\n\nfunction Home() {\n  const navigate = useNavigate();\n  const { categoryId, sort, currentPage, searchValue } =\n    useSelector(selectFilter);\n  const { items, status } = useSelector((state: RootState) => state.pizza);\n\n  const dispatch = useAppDispatch();\n\n  const onChangeCategory = useCallback(\n    (id: number) => dispatch(setCategoryId(id)),\n    []\n  );\n  const onChangePageCount = useCallback(\n    (num: number) => dispatch(setCurrentPage(num)),\n    []\n  );\n\n  const isSearch = useRef(false);\n  const isMounted = useRef(false);\n\n  // Запрос через асинхронный диспатч на сервер\n  const fetchPizza = async () => {\n    const category = categoryId > 0 ? `category=${categoryId}` : \"\"; // сортировка по категориям\n    const sortBy = sort.sortProperty.replace(\"-\", \"\"); // убираем \"-\" из параметров\n    const order = sort.sortProperty.includes(\"-\") ? \"asc\" : \"desc\"; // указываем тип фильтрации\n    const search = searchValue ? `&name=${searchValue}` : \"\"; // поиск по мячам\n\n    await dispatch(\n      fetchPizzas({\n        currentPage: String(currentPage),\n        category,\n        sortBy,\n        order,\n        search,\n      })\n    );\n  };\n  // Убираем отображение в URL параметров при первом рендере страницы\n  useEffect(() => {\n    if (isMounted.current) {\n      const queryString = qs.stringify({\n        sortProperty: sort.sortProperty,\n        categoryId,\n        currentPage,\n      });\n      navigate(`?${queryString}`);\n    }\n    isMounted.current = true;\n  }, [categoryId, sort.sortProperty, searchValue, currentPage]);\n\n  // Если был первый рендер, проверяем URL-параметры и сохраняем в redux\n\n  useEffect(() => {\n    if (window.location.search) {\n      const params = qs.parse(\n        window.location.search.substring(1)\n      ) as unknown as SearchPizzaParams;\n      const sort = sortList.find((item) => item.sortProperty === params.sortBy);\n\n      dispatch(\n        setFilters({\n          searchValue: params.search,\n          categoryId: Number(params.category),\n          currentPage: Number(params.currentPage),\n          sort: sort || sortList[0],\n        })\n      );\n      isSearch.current = true;\n    }\n  }, []);\n\n  // Проверяем, если ли в адресной строке данные.\n  useEffect(() => {\n    fetchPizza();\n    isSearch.current = false;\n  }, [categoryId, sort.sortProperty, searchValue, currentPage]);\n\n  // Генерация  компонентов мячей\n  const pizzas = items.map((obj: any) => <PizzaBlock key={obj.id} {...obj} />);\n\n  const skeletons = [...new Array(4)].map((_, index) => (\n    <Skeleton key={index} />\n  ));\n\n  return (\n    <div className=\"container\">\n      <div className=\"content__top\">\n        <Categories value={categoryId} onClickCategory={onChangeCategory} />\n        <Sort />\n      </div>\n      {status === \"error\" ? (\n        <div className=\"content__error-info\">\n          <div>\n            <span>😕</span>\n          </div>\n          <h2>\n            К сожалению, не удалось отобразить мячи.\n            <br /> Повторите попытку позже.{\" \"}\n          </h2>\n        </div>\n      ) : (\n        <>\n          <h2 className=\"content__title\">Все мячи</h2>\n          <div className=\"content__items\">\n            {status === \"loading\" ? skeletons : pizzas}\n          </div>\n        </>\n      )}\n      <Pagination\n        currentPage={currentPage}\n        onChangePage={(num: number) => {\n          onChangePageCount(num);\n        }}\n      />\n    </div>\n  );\n}\n\nexport default Home;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}